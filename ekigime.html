<!DOCTYPE html>
<html lang="ja">
<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel="shortcut icon" type="image/png" href="/img/favicon.png" />
<title>ãˆããã‚ - ä¸­é–“é§…æ¤œç´¢</title>
</head>
<body>
<div class="container">
<header class="d-flex justify-content-center py-3 align-items-center">
  <ul class="nav nav-pills">
    <li class="nav-item align-self-center"><a href="/" class="nav-link"><img src="/img/logo.svg" alt="ãˆããã‚" width="64px" height="30px"></a></li>
    <li class="nav-item align-self-center"><a href="/ekigime.html" class="nav-link active" aria-current="page">ä¸­é–“é§…æ¤œç´¢</a></li>
    <li class="nav-item align-self-center"><a href="/hyakumeiten.html" class="nav-link">ç™¾ååº—æ¤œç´¢</a></li>
  </ul>
</header>
<script type="module">
import { get_min_all_json, get_eki_all_json, default as init } from './pkg/ekigime.js'

(async function () {
    await init();
    window.get_min_all_obj = function (eki_id) {
        return JSON.parse(get_min_all_json(eki_id));
    };
    window.eki_id = JSON.parse(get_eki_all_json());
    window.id_eki = {};
    for (let eki in eki_id) {
        window.id_eki[eki_id[eki]] = eki;
    }

    // auto complete / suggest ç”¨ã« datalist ã‚’è¿½åŠ 
    let datalist = document.createElement('datalist');
    datalist.id = "ekilist";
    for (let eki of Object.keys(eki_id).sort()) {
        if (eki == "DUMMY") {
            continue;
        }
        let option = document.createElement('option');
        option.innerText = eki;
        datalist.appendChild(option);
    }
    document.body.appendChild(datalist);
})();

window.min2string = function (min) {
    let min_int = parseInt(min * 10, 10);
    let hour_int = Math.floor(min_int / 600);
    let min_nokori = min_int % 600;
    if (hour_int >= 1) {
        return String(hour_int) + 'æ™‚é–“' + String(min_nokori / 10) + 'åˆ†';
    } else {
        return String(min_nokori / 10) + 'åˆ†';
    }
};

window.i = 0;
window.loading = function () {
    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³è¡¨ç¤º
    document.getElementById("hyoujibutton").disabled = true;
    document.getElementById("hyoujimoji").innerText = "è¨ˆç®—ã—ã¦ã„ã¾ã™â€¦" + (window.i++ ? "" : "(åˆå›ã¯1åˆ†ã»ã©ã‹ã‹ã‚Šã¾ã™ï¼)");
    document.getElementById("hyoujispinner").style.display = ""
};

window.stoploading = function () {
    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³éè¡¨ç¤º
    document.getElementById("hyoujispinner").style.display = "none"
    document.getElementById("hyoujibutton").disabled = false;
    document.getElementById("hyoujimoji").innerText = "è¡¨ç¤ºã™ã‚‹";
};

window.hyouji = function () {
    if (!window.get_min_all_obj || !window.eki_id) {
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³éè¡¨ç¤º
        window.stoploading();
        return;
    }
    // è¨ˆç®—
    let result = [ {} ]; // index: 0 ã¯åˆè¨ˆå€¤ã‚’æ ¼ç´ã™ã‚‹
    let eki_max = 0;
    for (let i = 1; i < 20 ; i++) {
        let element = document.getElementById('eki' + i);
        if (!element || !element.value || !eki_id[element.value]) {
            eki_max = i - 1;
            break;
        }
        let min_all = get_min_all_obj(eki_id[element.value]);
        for (let eki_id in min_all) {
            let min = parseInt(min_all[eki_id]);
            result[0][eki_id] = result[0][eki_id] ? result[0][eki_id] + min : min;
        }
        result[i] = min_all;
    }
    let sorted_eki = Object.keys(id_eki).sort(function (eki_id1, eki_id2) {
        return result[0][eki_id1] - result[0][eki_id2];
    });

    //ã€€å‡ºåŠ›
    let emoji = { 0: 'ğŸ¥‡', 1: 'ğŸ¥ˆ', 2: 'ğŸ¥‰', 3: '', 4: '' };
    for (let i = 0; i < 3 ; i++) {
        //console.log(sorted_eki[i] + ', ' + id_eki[sorted_eki[i]] + ', ' + result[0][sorted_eki[i]] + ', ');
        for (let j = 1; j <= 10; j++) {
            let element = document.getElementById('a' + j + '-' + (i + 1) );
            element.innerText = j <= eki_max ? min2string(result[j][sorted_eki[i]]) : '';
        }
        let res = document.getElementById('result-' + (i + 1) );
        res.innerText = emoji[i] + '\n' + id_eki[sorted_eki[i]];
        let avg = document.getElementById('avg-' + (i + 1) );
        avg.innerText = min2string(result[0][sorted_eki[i]] / eki_max);
    }

    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³éè¡¨ç¤º
    window.stoploading();
};
</script>

<main>
<div class="row"><div class="col"><a id="result-0">ä¹—è»Šæ™‚é–“ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼š</a></div><div class="col"><a id="result-1"></a></div><div class="col"><a id="result-2"></a></div><div class="col"><a id="result-3"></a></div></div>
<div class="row"><div class="col"><a id="avg-0">å¹³å‡ä¹—è»Šæ™‚é–“ï¼š</a></div><div class="col"><a id="avg-1"></a></div><div class="col"><a id="avg-2"></a></div><div class="col"><a id="avg-3"></a></div></div>
<div class="row"><div class="col"><input id="eki1" type="search" value="" list="ekilist" /></div><div class="col"><a id="a1-1"></a></div><div class="col"><a id="a1-2"></a></div><div class="col"><a id="a1-3"></a></div></div>
<div class="row"><div class="col"><input id="eki2" type="search" value="" list="ekilist" /></div><div class="col"><a id="a2-1"></a></div><div class="col"><a id="a2-2"></a></div><div class="col"><a id="a2-3"></a></div></div>
<div class="row"><div class="col"><input id="eki3" type="search" value="" list="ekilist" /></div><div class="col"><a id="a3-1"></a></div><div class="col"><a id="a3-2"></a></div><div class="col"><a id="a3-3"></a></div></div>
<div class="row"><div class="col"><input id="eki4" type="search" value="" list="ekilist" /></div><div class="col"><a id="a4-1"></a></div><div class="col"><a id="a4-2"></a></div><div class="col"><a id="a4-3"></a></div></div>
<div class="row"><div class="col"><input id="eki5" type="search" value="" list="ekilist" /></div><div class="col"><a id="a5-1"></a></div><div class="col"><a id="a5-2"></a></div><div class="col"><a id="a5-3"></a></div></div>
<div class="row"><div class="col"><input id="eki6" type="search" value="" list="ekilist" /></div><div class="col"><a id="a6-1"></a></div><div class="col"><a id="a6-2"></a></div><div class="col"><a id="a6-3"></a></div></div>
<div class="row"><div class="col"><input id="eki7" type="search" value="" list="ekilist" /></div><div class="col"><a id="a7-1"></a></div><div class="col"><a id="a7-2"></a></div><div class="col"><a id="a7-3"></a></div></div>
<div class="row"><div class="col"><input id="eki8" type="search" value="" list="ekilist" /></div><div class="col"><a id="a8-1"></a></div><div class="col"><a id="a8-2"></a></div><div class="col"><a id="a8-3"></a></div></div>
<div class="row"><div class="col"><input id="eki9" type="search" value="" list="ekilist" /></div><div class="col"><a id="a9-1"></a></div><div class="col"><a id="a9-2"></a></div><div class="col"><a id="a9-3"></a></div></div>
<div class="row"><div class="col"><input id="eki10" type="search" value="" list="ekilist" /></div><div class="col"><a id="a10-1"></a></div><div class="col"><a id="a10-2"></a></div><div class="col"><a id="a10-3"></a></div></div>
<button id="hyoujibutton" onclick="loading(); setTimeout('hyouji()', 10)">
<span id="hyoujispinner" style="display:none" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
<span id="hyoujimoji">è¡¨ç¤ºã™ã‚‹ï¼</span>

</button>

</main>

<footer class="d-flex justify-content-center">
<div>Â© SMB 2023</div>
</footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>
